<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; L9 // Дисперсионный анализ. Ковариационный анализ – L // WLM 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./l10.html" rel="next">
<link href="./l8.html" rel="prev">
<link href="./pics/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-474c6d7e63be50eb6972897072b39b27.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3f14476484311c28f16e4ef7388d5d41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-317518b595e9c4efdce348cd04e6c053.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Ничего не найдено",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отмена",
    "search-submit-button-title": "Отправить",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./pics/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">WLM 2023 // HSE UX LAB</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../hub/index.html"> 
<span class="menu-text">Хаб</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../lectures/index.html"> 
<span class="menu-text">Лекции</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../practice/index.html"> 
<span class="menu-text">Практики</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../homeworks/index.html"> 
<span class="menu-text">Домашки</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./../projects/index.html"> 
<span class="menu-text">Проекты</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./l9.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">L9 // Дисперсионный анализ. Ковариационный анализ</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Вступление</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">L1 // Основы R. Типы и структура данных. Функции и управляющие конструкции</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">L2 // Предобработка данных. Дата и время. Визуализация данных</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Математика и статистика</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">L3 // Математика для анализа данных</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">L4 // Теория измерений</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">L5 // Введение в статистику. Случайный эксперимент и случайные величины</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">L6 // Оценивание параметров в практике статистического анализа. Тестирование статистических гипотез</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Анализ данных</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">L7 // Описательные статистики. Корреляционный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">L8 // Общие линейные модели. Простая и множественная линейная регрессия</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l9.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">L9 // Дисперсионный анализ. Ковариационный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">L10 // Обобщенные линейные модели. Логистическая регрессия. Пуассоновская регрессия</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">L12 // Линейные модели со смешанными эффектами</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">L13 // Кластерный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">L14 // Анализ главных компонент и эксплораторный факторный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">L15 // Структурное моделирование и конфирматорный факторный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Источники</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#регрессия-только-с-категориальными-предикторами" id="toc-регрессия-только-с-категориальными-предикторами" class="nav-link active" data-scroll-target="#регрессия-только-с-категориальными-предикторами"><span class="header-section-number">9.1</span> Регрессия только с категориальными предикторами</a>
  <ul class="collapse">
  <li><a href="#параметризация-индикаторов" id="toc-параметризация-индикаторов" class="nav-link" data-scroll-target="#параметризация-индикаторов"><span class="header-section-number">9.1.1</span> Параметризация индикаторов</a></li>
  <li><a href="#параметризация-эффектов" id="toc-параметризация-эффектов" class="nav-link" data-scroll-target="#параметризация-эффектов"><span class="header-section-number">9.1.2</span> Параметризация эффектов</a></li>
  </ul></li>
  <li><a href="#однофакторный-дисперсионный-анализ" id="toc-однофакторный-дисперсионный-анализ" class="nav-link" data-scroll-target="#однофакторный-дисперсионный-анализ"><span class="header-section-number">9.2</span> Однофакторный дисперсионный анализ</a>
  <ul class="collapse">
  <li><a href="#структура-изменчивости-данных" id="toc-структура-изменчивости-данных" class="nav-link" data-scroll-target="#структура-изменчивости-данных"><span class="header-section-number">9.2.1</span> Структура изменчивости данных</a></li>
  <li><a href="#тестирование-гипотез-в-однофакторном-дисперсионном-анализе" id="toc-тестирование-гипотез-в-однофакторном-дисперсионном-анализе" class="nav-link" data-scroll-target="#тестирование-гипотез-в-однофакторном-дисперсионном-анализе"><span class="header-section-number">9.2.2</span> Тестирование гипотез в однофакторном дисперсионном анализе</a></li>
  <li><a href="#размер-эффекта" id="toc-размер-эффекта" class="nav-link" data-scroll-target="#размер-эффекта"><span class="header-section-number">9.2.3</span> Размер эффекта</a></li>
  <li><a href="#попарные-сравнения" id="toc-попарные-сравнения" class="nav-link" data-scroll-target="#попарные-сравнения"><span class="header-section-number">9.2.4</span> Попарные сравнения</a></li>
  <li><a href="#допущения-дисперсионного-анализа" id="toc-допущения-дисперсионного-анализа" class="nav-link" data-scroll-target="#допущения-дисперсионного-анализа"><span class="header-section-number">9.2.5</span> Допущения дисперсионного анализа</a></li>
  </ul></li>
  <li><a href="#дизайн-экспериментального-исследования" id="toc-дизайн-экспериментального-исследования" class="nav-link" data-scroll-target="#дизайн-экспериментального-исследования"><span class="header-section-number">9.3</span> Дизайн экспериментального исследования</a></li>
  <li><a href="#многофакторный-дисперсионный-анализ" id="toc-многофакторный-дисперсионный-анализ" class="nav-link" data-scroll-target="#многофакторный-дисперсионный-анализ"><span class="header-section-number">9.4</span> Многофакторный дисперсионный анализ</a></li>
  <li><a href="#partial-eta2" id="toc-partial-eta2" class="nav-link" data-scroll-target="#partial-eta2"><span class="header-section-number">9.5</span> Partial <span class="math inline">\(\eta^2\)</span></a>
  <ul class="collapse">
  <li><a href="#повторные-измерения" id="toc-повторные-измерения" class="nav-link" data-scroll-target="#повторные-измерения"><span class="header-section-number">9.5.1</span> Повторные измерения</a></li>
  <li><a href="#типы-сумм-квадратов" id="toc-типы-сумм-квадратов" class="nav-link" data-scroll-target="#типы-сумм-квадратов"><span class="header-section-number">9.5.2</span> Типы сумм квадратов</a></li>
  </ul></li>
  <li><a href="#контрасты" id="toc-контрасты" class="nav-link" data-scroll-target="#контрасты"><span class="header-section-number">9.6</span> Контрасты</a></li>
  <li><a href="#ковариационный-анализ" id="toc-ковариационный-анализ" class="nav-link" data-scroll-target="#ковариационный-анализ"><span class="header-section-number">9.7</span> Ковариационный анализ</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">L9 // Дисперсионный анализ. Ковариационный анализ</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!--- {{< include ../other/_symbols.qmd >}} --->
<!--- Logic --->
<!--- Number sets--->
<!--- Linear Algebra --->
<!--- vectors and matrices --->
<!--- transposed matrix --->
<!--- Probability, Random Vars --->
<!--- Distributions --->
<!--- Other --->
<!--- Trig --->
<!--- Stats --->
<p>Мы знаем, что в регрессионную модель можно включать как количественные, так и категориальные предикторы. Более того, мы знаем, как при включении категориальных предикторов изменяется модель и что значат коэффициенты при этих предикторах. Теперь рассмотрим случай, когда в модели останутся только категориальные предикторы.</p>
<section id="регрессия-только-с-категориальными-предикторами" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="регрессия-только-с-категориальными-предикторами"><span class="header-section-number">9.1</span> Регрессия только с категориальными предикторами</h2>
<p>Пусть у нас есть один категориальный предиктор с двумя уровнями, то есть у нас есть две группы наблюдений. Если из моделей, рассмотренных ранее, мы исключим количественные предикторы, то получим модель такого вида:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 I,
\]</span></p>
<p>где <span class="math inline">\(I\)</span> — переменная-индикатор, обозначающая, к какой группе принадлежит наблюдение (<span class="math inline">\(I = 0\)</span>, если наблюдение относится к первой группе 1, и <span class="math inline">\(I = 1\)</span>, если наблюдение относится ко второй группе). Итого, получается, что в одной модели заключены как бы две сразу:</p>
<p><span class="math display">\[
\begin{cases}
I = 0 &amp;: \hat y_i = b_0 \\
I = 1 &amp;: \hat y_i = b_0 + b_1
\end{cases}
\]</span></p>
<p>Что же будет, если у нас возникнет не две группы по какой-то категориальной переменной, а три? Тогда одной переменной-индикатором мы уже не обойдемся — нам понадобится две индикаторные переменные. Получится следующая модель:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 I_{\text{Gr}_2} + b_2 I_{\text{Gr}_3},
\]</span></p>
<p>где</p>
<ul>
<li><span class="math inline">\(I_{\text{Gr}_2}\)</span> — переменная-индикатор, обозначающая принадлежность наблюдения ко второй группе (<span class="math inline">\(I_{\text{Gr}_2} = 0\)</span>, если наблюдение не относится ко второй группе, и <span class="math inline">\(I_{\text{Gr}_2} = 1\)</span>, если наблюдение относится ко второй группе)</li>
<li><span class="math inline">\(I_{\text{Gr}_3}\)</span> — переменная-индикатор, обозначающая принадлежность наблюдения к третьей группе (<span class="math inline">\(I_{\text{Gr}_3} = 0\)</span>, если наблюдение не относится к третьей группе, и <span class="math inline">\(I_{\text{Gr}_3} = 1\)</span>, если наблюдение относится к третьей группе). Итого, получается, что в одной модели заключены целых три сразу:</li>
</ul>
<p><span class="math display">\[
\begin{cases}
I_{\text{Gr}_2} = 0 \wedge I_{\text{Gr}_3} = 0 &amp;: \hat y_i = b_0 &amp; (\text{Group 1})\\
I_{\text{Gr}_2} = 1 \wedge I_{\text{Gr}_3} = 0 &amp;: \hat y_i = b_0 + b_1 &amp; (\text{Group 2}) \\
I_{\text{Gr}_2} = 0 \wedge I_{\text{Gr}_3} = 1 &amp;: \hat y_i = b_0 + b_2 &amp; (\text{Group 3})
\end{cases}
\]</span></p>
<p>Мы вводили в модели переменные-индикаторы для того, чтобы обозначит категориальные переменные и понять, как они меняют модель. Теперь же, когда мы работаем только с категориальными предикторами, мы можем обозначить перемеренные-индикаторы как <span class="math inline">\(x_j\)</span>, чтобы еще более наглядно увидеть, что модель с категориальными предикторами полностью совпадает с моделью обычной линейной регрессии. Значениями, которые принимают переменные-индикаторы, кодируются группы наблюдений. Мы можем составить следующую таблицу кодировки:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Группа</th>
<th style="text-align: center;"><span class="math inline">\(I_1 = x_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(I_2 = x_2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_1\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_2\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_3\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>Таким образом, мы можем записать модель следующим образом:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 x_1 + b_2 x_2
\]</span></p>
<p>Обратим внимание, что сейчас мы рассматривает три группы и у нас две индикаторные переменные. В случае, если у нас <span class="math inline">\(k\)</span> групп, то индикаторных переменных будет <span class="math inline">\(k-1\)</span>:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 x_1 + b_2 x_2 + \dots + b_{k-1}x_{k-1}
\]</span></p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Группа</th>
<th style="text-align: center;"><span class="math inline">\(x_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(x_2\)</span></th>
<th><span class="math inline">\(\dots\)</span></th>
<th><span class="math inline">\(x_{k-2}\)</span></th>
<th><span class="math inline">\(x_{k-1}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_1\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td><span class="math inline">\(\dots\)</span></td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_2\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td><span class="math inline">\(\dots\)</span></td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_3\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td><span class="math inline">\(\dots\)</span></td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\vdots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\vdots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\ddots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_{k-1}\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td><span class="math inline">\(\dots\)</span></td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_k\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td><span class="math inline">\(\dots\)</span></td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Однако вернемся к случаю трех групп, так как этот случай достаточно прост и удобен для рассмотрения имеющейся ситуации. Попробуем визуализировать связь между некоторой целевой количественной переменной и категориальным предиктором. Получится следующая картинка:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Мы видим, что у нас есть категориальный предиктор, которые разбивает наши наблюдения на три группы — <code>Gr₁</code>, <code>Gr₂</code> и <code>Gr₃</code> — в каждой из которых есть определенный разборс значений. Само же положение это группы на вертикальной оси определяется средним целевой переменной в данной группе. Таким образом, мы можем дополнить визуализацию этими средними значениями (цвет добавлен для лучшего визуального разделения групп):</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Мы видим, что с точки зрения линейной модели у нас есть три интерсепта, а с точки зрения данных эти три интерсепта являются среднии групп наблюдений. То есть,</p>
<p><span class="math display">\[
\cases{
\bar y_{\text{Gr}_1} = b_0 \\
\bar y_{\text{Gr}_2} = b_0 + b_1 \\
\bar y_{\text{Gr}_3} = b_0 + b_2 \\
}
\]</span> или на картинке:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="параметризация-индикаторов" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="параметризация-индикаторов"><span class="header-section-number">9.1.1</span> Параметризация индикаторов</h3>
<p>Способ подбора коэффициентов модели, который мы только что рассмотрели, называется <strong>параметризацией индикаторов (dummy coding, treatment parametrization, reference cell model)</strong>. В это способе получается следующее:</p>
<ul>
<li>одна из групп по категориальной переменной берется в качестве базовой — её интерсепт будет обозначен как <span class="math inline">\(b_0\)</span></li>
<li>для остальных групп подбираются поправочные коэффициенты (<span class="math inline">\(b_1\)</span>, <span class="math inline">\(b_2\)</span>, <span class="math inline">\(...\)</span>, <span class="math inline">\(b_{k-1}\)</span>), которые определяют различия в интерсептах между этими группами и базовым уровнем</li>
</ul>
<p>Собственно, это ровно то, что и было у нас на предыдущих лекциях.</p>
</section>
<section id="параметризация-эффектов" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="параметризация-эффектов"><span class="header-section-number">9.1.2</span> Параметризация эффектов</h3>
<p>Однако на те же данные можно посмотреть и иным способом. Не всегда логично брать какую-то группу наблюдений в качестве базового уровня, к тому же в зависимости от того, какую из групп мы рассматриваем как базовую, меняются значения коэффициентов модели. Есть ли какой-то способ записать более «обобщённую» модель?</p>
<p>Да, он есть. Давайте рассматривать в качестве базового уровня <em>среднее по всем наблюдениям</em>. Тогда коэффициентами при переменных в модели будут отклонения групповых средних от общего среднего. Вот картинка:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Сама математическая запись модели не изменится:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 x_1 + b_2 x_2
\]</span></p>
<p>однако интерпретация коэффициент здесь будет иная: теперь коэффициенты показывают отклонения [средних] групп от общего среднего, то есть коэффициенты показывают <em>эффект</em> предиктора для конкретной группы. Данный способ подбора называется <strong>параметризацией эффектов (effects coding, sum-to-zero parameterization)</strong>. Отдельная интересность здесь в том, как считается интерсепт для третьей группы <code>Gr₃</code> — он оказывает равен <span class="math inline">\(b_0 - b_1 - b_2\)</span>. Это связано с таблицей кодировки, использующейся в данном способе подбора коэффициентов:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Группа</th>
<th style="text-align: center;"><span class="math inline">\(x_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(x_2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_1\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_2\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\text{Gr}_3\)</span></td>
<td style="text-align: center;">−1</td>
<td style="text-align: center;">−1</td>
</tr>
</tbody>
</table>
<p>Чтобы модель работала, сумма по колонкам в таблице кодировки должна быть равна нулю, поэтому возникают −1.</p>
</section>
</section>
<section id="однофакторный-дисперсионный-анализ" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="однофакторный-дисперсионный-анализ"><span class="header-section-number">9.2</span> Однофакторный дисперсионный анализ</h2>
<p>Задумаемся:</p>
<ul>
<li>у нас есть некоторая странная, но занимательная модель, получившаяся с использованием параметризации эффектов</li>
<li>у нас есть данные, которые неопределенны и вариативны</li>
<li>данные мы собирали для того, чтобы изучить связь между целевой переменной и предиктором</li>
</ul>
<p>Разумно предполагать, что если связь между целевой переменной и предиктором есть, то мы будем наблюдать какую-то такую картинку:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Если же связи нет, то будет наблюдатся что-то такое:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Описать эти ситуации можно, изучив структуру изменчивости данных.</p>
<section id="структура-изменчивости-данных" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="структура-изменчивости-данных"><span class="header-section-number">9.2.1</span> Структура изменчивости данных</h3>
<p>При изучении линейной регрессии мы знакомились с такой метрикой изменчивости, как сумма квадратов — используем её и здесь. В данных есть <strong>общая изменчивость, или общая сумма квадратов (total sum of squares, <span class="math inline">\(\text{SS}_t\)</span>)</strong> — отклонения наблюдений от общего среднего значения:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Есть в данных <strong>факторная изменчивость, или объясненная сумма квадратов (explained sum of squares, <span class="math inline">\(\text{SS}_X\)</span>)</strong> — отклонения групповых средних от общего среднего:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Эта изменчивость складывается из показателей того, насколько каждая группа <em>в среднем</em> отклоняется от общего среднего. Здесь надо сделать замечание, что термин <em>фактор</em> и <em>факторная изменчивость</em> возникает здесь по причине того, что часть изменчивости данных объясняется действием некоторого <em>фактора</em>, который в терминах математических моделей мы называем предиктором.</p>
<p>И в данных также остается <strong>случайная изменчивость, или сумма квадратов ошибок (error sum of squares, <span class="math inline">\(\text{SS}_e\)</span>)</strong> — отклонения наблюдений от своих групповых средних:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>С точки зрения математической модели эти три изменчивости — <span class="math inline">\(\text{SS}_t\)</span>, <span class="math inline">\(\text{SS}_X\)</span> и <span class="math inline">\(\text{SS}_e\)</span> — совпадают соответственно с <span class="math inline">\(\text{TSS}\)</span>, <span class="math inline">\(\text{ESS}\)</span> и <span class="math inline">\(\text{RSS}\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Математически эти изменчивости записываются так:</p>
<p><span class="math display">\[
\begin{split}
\text{TSS} &amp;= \text{SS}_t = \displaystyle \sum_{i=1}^n (\bar y - y_i)^2, \\
\text{ESS} &amp;= \text{SS}_X = \displaystyle \sum_{j=1}^k n_j \cdot (\bar y - \bar y_j)^2, \\
\text{RSS} &amp;= \text{SS}_e = \displaystyle \sum_{j=1}^k \sum_{i=1}^{n_j} (\bar y_j - \bar y_{ji})^2,
\end{split}
\]</span></p>
<p>где <span class="math inline">\(n\)</span> — общее количество наблюдений, <span class="math inline">\(n_j\)</span> — количество наблюдений в конкретной <span class="math inline">\(j\)</span>-ой группе, <span class="math inline">\(k\)</span> — количество групп.</p>
<p>Окей, с самой структурой изменчивости разобрались. Теперь вернемся к двум ситуациям, которые мы хотели описать:</p>
<ol type="1">
<li>связь между предиктором и целевой переменной есть:</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>связи между предиктором и целевой переменной нет:</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Поскольку рассматривать общую изменчивость не слишком осмысленно, в том числе потому что выполяется соотношение <span class="math inline">\(\text{TSS} = \text{ESS} + \text{RSS}\)</span> или <span class="math inline">\(\text{SS}_t = \text{SS}_X + \text{SS}_e\)</span>, рассмотрим, как в двух интересующих нас случаях соотносятся <strong>объясненная (факторная)</strong> и <strong>случайная (остаточная) изменчивости</strong>.</p>
<ul>
<li>В первом случае, когда закономерность есть, мы получим ситуацию, когда факторная изменчивость будет больше, чем случайная, то есть <span class="math inline">\(\text{SS}_X &gt; \text{SS}_e\)</span>.</li>
<li>В втором случае, когда закономерности нет, мы получим ситуацию, когда факторная изменчивость будет меньше (или, по крайней мере, равна), чем случайная, то есть <span class="math inline">\(\text{SS}_X \leq \text{SS}_e\)</span>.</li>
</ul>
<p>Получается, используя эти изменчивости мы можем изучать гипотезы о связи между количественной и категориальной переменной.</p>
</section>
<section id="тестирование-гипотез-в-однофакторном-дисперсионном-анализе" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="тестирование-гипотез-в-однофакторном-дисперсионном-анализе"><span class="header-section-number">9.2.2</span> Тестирование гипотез в однофакторном дисперсионном анализе</h3>
<p>Чтобы перейти к тестированию гипотез, нам необходимо сами эти [статистические] гипотезы сформулировать. Исходя из внимательного рассмотрения картинок выше, мы можем получить следующие гипотезы для дисперсионного анализа:</p>
<p><span class="math display">\[
\begin{split}
H_0&amp;: \mu_0 = \mu_1 = \mu_2 = \ldots = \mu_k \\
H_1&amp;: \exists \, j_1, j_2: \mu_{j_1} \neq \mu_{j_2}
\end{split}
\]</span></p>
<p>Нулевая гипотеза говорит, что средние всех групп в генеральной совокупности равны между собой. Альтернативная гипотеза говорит, что <em>существуют хотя бы две группы</em>, cредние которых различаются. Для тестирования этой гипотезы мы могли бы посмотреть на отношение между объясненной и остаточной изменчивостями (суммами квадратов), но количество наблюдений в разных группах имеет право на совпадать, поэтому используют средние квадраты — иначе, дисперсии:</p>
<p><span class="math display">\[
\begin{split}
\text{MS}_t &amp;= \frac{\text{SS}_t}{n-1} = \frac{\text{TSS}}{n-1} = \frac{\sum_{i=1}^n (\bar y - y_i)}{n-1} \\
\text{MS}_X &amp;= \frac{\text{SS}_X}{k-1} = \frac{\text{ESS}}{k-1} = \frac{n_j \cdot \sum_{j=1}^k (\bar y - \bar y_j)}{k-1} \\
\text{MS}_e &amp;= \frac{\text{SS}_e}{n-k} = \frac{\text{RSS}}{n-k} = \frac{\sum_{j=1}^k \sum_{i=1}^{n_j} (\bar y_j - \bar y_{ji})}{n-k}
\end{split}
\]</span></p>
<p>Собственно, поэтому анализ и называется дисперсионный (analysis of variance, ANOVA). Статистика, используемая для тестирования заявленной гипотезы — это F-статистика, значение которой рассчитывается так:</p>
<p><span class="math display">\[
F = \frac{\text{MS}_X}{\text{MS}_e} \overset{H_0}{\thicksim} F(\text{df}_{\text{MS}_X}, \text{df}_{\text{MS}_e})
\]</span></p>
<p>Эта статистика подчиняется F-распределению со степенями свободы <span class="math inline">\(\text{df}_{\text{MS}_X} = k - 1\)</span> и <span class="math inline">\(\text{df}_{\text{MS}_e} = n - k\)</span>. Таким образом, если</p>
<ul>
<li>не получено статистически значимого результата, то у нас нет оснований говорить, что между какими-либо группами есть различия, а если</li>
<li>получен статистически значимый результат, то мы можем говорить, что <em>между какими-либо двумя группами есть различия</em>.</li>
</ul>
</section>
<section id="размер-эффекта" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3" class="anchored" data-anchor-id="размер-эффекта"><span class="header-section-number">9.2.3</span> Размер эффекта</h3>
<p>Когда мы обсуждали тестирование статистических гипотез, мы также упоминали о размере эффекта — метрики, которая позволяет оценить силу связи между переменными. В случае корреляционного анализа нам повезло, и сам коэффициент корреляции был размером эффекта для себя же. В случае линейной регрессии мы вроде бы не говорили о размере эффекта, однако если мы внимательно всмотримся в <span class="math inline">\(R^2\)</span>, то осознаем, что он и является метрикой, позволяющей говорить о силе связи между переменными — в случае множественной линейной регрессии о силе связи между целевой переменной и несколькими предикторами сразу.</p>
<p>Для дисперсионного анализа также необходима специальная метрика. Она придумана и называется <span class="math inline">\(\eta^2\)</span>. Она считается следующим образом:</p>
<p><span class="math display">\[
\eta^2 = \frac{\text{ESS}}{\text{TSS}} = \frac{\text{SS}_X}{\text{SS}_t}
\]</span></p>
<p>Из формулы видно, что <strong>размер эффекта — это доля объясненной фактором дисперсии от всей дисперсии данных</strong>, что в общем-то весьма логично.</p>
<p>Для интерпретации значения размера эффекта предлагаются следующие пороговые значения:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Значение <span class="math inline">\(\eta^2\)</span></th>
<th style="text-align: center;">Размер эффекта</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(0.01\)</span></td>
<td style="text-align: center;">Малый (small)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(0.06\)</span></td>
<td style="text-align: center;">Средний (medium)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(0.14\)</span></td>
<td style="text-align: center;">Большой (large)</td>
</tr>
</tbody>
</table>
</section>
<section id="попарные-сравнения" class="level3" data-number="9.2.4">
<h3 data-number="9.2.4" class="anchored" data-anchor-id="попарные-сравнения"><span class="header-section-number">9.2.4</span> Попарные сравнения</h3>
<p>Статистически значимый результат дисперсионного анализа приводит нас к интересному выводу: хотя бы двумя группами есть различия — но между какими? Ответа на этот вопрос дисперсионный анализ не дает, а знать ответ критически хочется. Отсюда возникают попарные сравнения.</p>
<p>Задача попарных сравнений, которую можно нехитро вывести из их названия — сравнить попарно все группы наблюдений друг с другом и выяснить, есть ли между ними различия. F-статистика для этой задачи уже не подходит, поэтому берется <strong>t-статистика</strong>.</p>
<p>Мы уже видели так называемый <em>одновыборочный t-тест</em> в корреляционном анализе (при тестировании статистической значимости коэффициента корреляции) и регрессии (при тестировании статистической значимости коэффициента регрессионной модели). Однако t-тест позволяет сравнить и две выборки друг с другом. Формула его расчета несколько изменится, но общая логика останется той же — в числителе стоят сравниваемые средние, а в знаменателе расположена их стандартная ошибка:</p>
<p><span class="math display">\[
t = \frac{\bar X_1 - \bar X_2}{\displaystyle \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}} \overset{H_0}{\thicksim} t(\text{df}),
\]</span></p>
<p>где <span class="math inline">\(\bar X_1\)</span> и <span class="math inline">\(\bar X_2\)</span> — средние сравниваемых групп, <span class="math inline">\(s_1^2\)</span> и <span class="math inline">\(s_2^2\)</span> — дисперсии сравниваемых групп, <span class="math inline">\(n_1\)</span> и <span class="math inline">\(n_2\)</span> — количество наблюдений в сравниваемых группах.</p>
<p>Гипотезы для t-теста в этом случае будут формулироваться так:</p>
<p><span class="math display">\[
\begin{split}
H_0 &amp;: \mu_1 = \mu_2 \\
H_1 &amp;: \mu_1 \neq \mu_2
\end{split}
\]</span></p>
<details>
<summary>
Степени свободы вычисляются весьма хитро
</summary>
<p><span class="math display">\[
\text{df} = \frac{\left(\displaystyle \frac{s_1^2}{n_1} + \frac{s_2^2}{n_2} \right)^2}
{\displaystyle \frac{1}{n_1 - 1} \left(\frac{s_1^2}{n_1} \right)^2 + \frac{1}{n_2 - 1} \left(\frac{s_2^2}{n_2} \right)^2}
\]</span></p>
<hr>
</details>
<p>Получается, что мы может взять t-тест, сравнить попарно группы друг с другом и выяснить, между какими группами есть различия. Почти. Иначе нам бессмысленно было бы городить дисперсионный анализ.</p>
<p>В силу проблемы множественных сравнений, которую мы обсуждали в теме тестирования статистических гипотез, необходимо скорректировать уровень значимости. Способы существуют разные — поправки Бонферрони, Холма, Тьюки — но суть одна: необходимо понизить уровень значимости, чтобы избежать увеличения вероятности ложноположительного вывода.</p>
<p>Итого,</p>
<ul>
<li>если мы <strong>получили статистически значимый результат</strong> дисперсионного анализа, <strong>необходимо провести попарные сравнения</strong> (другое название — post hoc тесты), чтобы выяснить, между какими именно группами есть различия</li>
<li>если мы <strong>не получили статистически значимый результат</strong> дисперсионного анализа, проводить попарные сравнения не нужно, так как сама нулевая гипотеза дисперсионного анализа говорит о том, что различий между группами нет</li>
</ul>
</section>
<section id="допущения-дисперсионного-анализа" class="level3" data-number="9.2.5">
<h3 data-number="9.2.5" class="anchored" data-anchor-id="допущения-дисперсионного-анализа"><span class="header-section-number">9.2.5</span> Допущения дисперсионного анализа</h3>
<p>Как и другие линейные модели, дисперсионному анализ выдвигает ряд требований к данным:</p>
<ul>
<li>Количественная непрерывная зависимая переменная</li>
<li>Независимые между собой выборки
<ul>
<li>А если зависимые, то надо это учесть в модели</li>
</ul></li>
<li>Нормальное распределение признака в генеральных совокупностях, из которых извлечены выборки</li>
<li>Равенство (гомогенность) дисперсий изучаемого признака в генеральных совокупностях из которых извлечены выборки
<ul>
<li>Проверяется с помощью теста Левина</li>
</ul></li>
<li>Независимые наблюдения в каждой из выборок</li>
</ul>
<hr>
<p>Подведем промежуточные итоги. Всё, о чем мы говорили выше, относится к <strong>однофакторному дисперсиионному анализу (One-way ANOVA)</strong>, так как мы рассматривали ситуацию, когда нас интересует связь между количественной и <strong>одной</strong> категориальной переменной. В этом случае с точки зрения математической модели в ней будет <strong>один</strong> предиктор.</p>
<p>Отдельно отметим случай, когда у нас категориальная переменная задаёт только <strong>две группы</strong>. Можно и нужно ли в этом случае использовать дисперсионный анализ или достаточно только t-теста? Есть утверждение, что для сравнения двух групп нужно использовать двухвыборочный t-тест, и это правда, так как t-тест позволяет сравнить средние в двух группах. Использовать дисперсиионный анализ для сравнения двух групп также можно, однако попарные сравнения в этом случае бессмысленны, так как у нас всего две группы. Более того, для случая двух групп выполняется следующее соотношение между F и t-статистиками:</p>
<p><span class="math display">\[
F = t^2
\]</span></p>
<p>Доказательство того факта можно найти <a href="https://stats.stackexchange.com/questions/55236/prove-f-test-is-equal-to-t-test-squared">здесь</a>.</p>
<hr>
<p>Конечно, мы крайне редко в рамках своих исследований мы редко вводим в их дизайн только одну [независимую] переменную, поэтому далее мы рассмотрим более сложные модели. Без погружения в математику, так как логика остается аналогичной обсужденной выше.</p>
</section>
</section>
<section id="дизайн-экспериментального-исследования" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="дизайн-экспериментального-исследования"><span class="header-section-number">9.3</span> Дизайн экспериментального исследования</h2>
<p>Прежде чем перейти к многофакторному дисперсионному анализу, нам необходимо сказать несколько слов о дизайне экспериментального исследования. Почему мы здесь говорим именно об эксперименте? Так сложилось, что ANOVA очень хорошо подходит для анализа экспериментальных данных, однако это не значит, что ею можно анализировать только экспериментальные данные. Тем не менее, для разных экспериментальных дизайнов нам будут нужны разные модели дисперсионного анализа.</p>
<p>Опуская детали, скажем, что принципиально существуют два возможных экспериментальных плана: межгрупповой и внутригрупповой.</p>
<ul>
<li>При <strong>межгрупповом плане</strong> у нас есть две или более групп, каждая из которых проходит различные экспериментальные условия, одно из которых может выступать в роли контрольного. Таким образом, один испытуемый проходит одно экспериментальное условие. Соответственно, разные испытуемые проходят разные экспериментальные условия.</li>
<li>При <strong>внутригрупповом плане</strong> у нас есть по сути одна группа испытуемых, которая проходит все экспериментальные условия. Получается, что каждый испытуемый проходит два или более экспериментальных условия, одно из которых также может являться контрольным.</li>
</ul>
<p>С точки зрения модели у нас появляются два разных типа эффектов:</p>
<ul>
<li><strong>межгрупповые эффекты (between-subject effects)</strong>, выражающие эффекты межгрупповых переменных (межгрупповой план)</li>
<li><strong>внутригрупповые эффекты (within-subject effects)</strong>, выражающие эффекты внутригрупповых переменных (внутригрупповой план)</li>
</ul>
<p>Если же у нас <strong>смешанный экспериментальный план</strong>, то в дизайне есть и межгрупповые, и внутригрупповые переменные, то и в модели будут оба типа эффектов.</p>
<p>В зависимости от того, каков дизайн нашего исследования, у нас будут разные модели дисперсионного анализа.</p>
</section>
<section id="многофакторный-дисперсионный-анализ" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="многофакторный-дисперсионный-анализ"><span class="header-section-number">9.4</span> Многофакторный дисперсионный анализ</h2>
<p>Подойдем к изучению моделей с несколькими категориальными предикторами с графической стороны. Поскольку в случае нескольких факторов картинка может значительно усложнится, не будет визуализировать отдельные наблюдения, как мы делали выше, а воспользуемся изображением средних с доверительными интервалами. Для начала посмотрим, как такие графики будут выглядеть в случае с одним предиктором (фактором).</p>
<p>Для случая, когда связь есть, мы имеем что-то такое:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Для случая, когда связи нет, картинка выглядит как-то так:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Пусть теперь у нас есть не один фактор, а два — <span class="math inline">\(A\)</span> и <span class="math inline">\(B\)</span>. Пусть оба фактора имеют по два уровня (задают каждый по две группы) — <span class="math inline">\(A_1\)</span>, <span class="math inline">\(A_2\)</span> и <span class="math inline">\(B_1\)</span>, <span class="math inline">\(B_2\)</span>. В этом случае принципиально возможны несколько ситуаций.</p>
<ul>
<li>нет эффекта для обоих факторов</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>есть эффекта для одного из факторов (в первом случае для фактора <span class="math inline">\(A\)</span>, во втором — для фактора <span class="math inline">\(B\)</span>)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>есть эффекта для обоих факторов</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>есть взаимодействие факторов</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l9_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Взаимодействие факторов говорит о том, что один фактор влияет на целевую переменную по-разному в зависимости от уровня второго фактора.</strong></p>
<p>С одной стороны, это довольно мощная фича дисперсионного анализа — возможность учесть взаимодействие факторов. Она позволяет нам посмотреть на происходящее в данных более подробно. Так, если мы будем смотреть только на основные эффекты, то можем потерять важные части закономерности:</p>
<center>
<figure class="figure">
<img src="pics/interaction_main.jpg" class="figure-img">
</figure>
</center>
<p>С другой стороны, значимое взаимодействие затрудняет интерпретацию основных эффектов. Если взаимодействие не значимо, то с интерпретацией главных эффектов трудностей не возникает. Если взаимодействие значимо, то обсуждать главнные эффекты необходимо аккуратно, или не обсуждать вовсе. В частности, нижний ряд рисунков выше показывает, как эффект фактора A частично маскирует эффект фактора B, что отражается во взаимодействии.</p>
<p>Конечно, в модель можно ввести и более двух факторов, и логика тестирования статистической значимости останется, как и всегда, та же самая. Но помните, что чем сложнее модель, тем сложнее её интерпретация. А интерпретируя взаимодействие трёх предикторов вовсе можно сойти с ума.</p>
<blockquote class="blockquote">
<p>В связи с этим, есть следующий момент. Когда вы планируете ваше исследование, сразу подумайте, как вы будете анализировать данные — что будет входить в модель в качестве основных предикторов, что в качестве ковариат, и какие взаимодействия в ней будут. Иначе измерить кучу переменных вы построите модель, результаты которой невозможно будет понять. Дизайн исследования очень тесно связан с аналитикой.</p>
</blockquote>
</section>
<section id="partial-eta2" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="partial-eta2"><span class="header-section-number">9.5</span> Partial <span class="math inline">\(\eta^2\)</span></h2>
<p>Поскольку теперь в модель включены несколько предикторов, они могут по-разному вкладываться в объяснение дисперсии. В каком-то смысле аналогично скорректированному <span class="math inline">\(R^\)</span> существует и более точная метрика для размера эффекта конкретного фактора в дисперсионном анализе — это partial <span class="math inline">\(\eta^2\)</span>. Она показывает долю объясненной фактором дисперсии при исключении вариативности, объясненной другими факторами. Эта метрика является основной для оценки размера эффекта в многофакторной дисперсионном анализе и именно она описывается в результатах.</p>
<p><span class="math display">\[
\eta^2_p = \frac{\text{SS}_X}{\text{SS}_X + \text{SS}_e}
\]</span></p>
<section id="повторные-измерения" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="повторные-измерения"><span class="header-section-number">9.5.1</span> Повторные измерения</h3>
<p>Отдельно оговорим ситуацию, когда у нас возникают внутригрупповые эффекты. В этом случае, напомним, каждый респондент проходит все условия эксперимента, в результате чего наблюдения оказываются связанными друг с другом — то есть нарушается допущение о независимости наблюдений. В силу этого нам нужна модификация исходной модели — <strong>дисперсионный анализ с повторными измерениями (repeated measures ANOVA, rm ANOVA)</strong>. У этой модифицированной модели есть ещё одно допущение/требование к данным — сферичность.</p>
<p><strong>Сферичность (sphericity)</strong> — это допущение, согласно которому дисперсии разностей между всеми парами уровней фактора равны. Нарушение допущения о сферичности — то есть отсутствие равенства дисперсий между парами уровней фактора — является серьезной проблемой для ANOVA, так как при этом тест становится слишком либеральным, то есть увеличению вероятность ошибки I рода.</p>
<p>К нашему счастью, если есть нарушение сферичности данных, то машина сама нам об этом сообщит, а также применит необходимые поправки, чтобы избежать рост вероятности ошибки I рода.</p>
</section>
<section id="типы-сумм-квадратов" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="типы-сумм-квадратов"><span class="header-section-number">9.5.2</span> Типы сумм квадратов</h3>
<p>Когда у нас в анализе появляется несколько факторов, мы можем тестировать их значимость различными способами. Способ тестирования определяет типа сумм квадратов, которых существует три.</p>
<ul>
<li><strong>Первый (I) тип</strong> сумм квадратов проводит последовательные тесты значимости факторов. Величина эффекта фактора зависит от объёма выборки. Кроме того, результат вычислений зависит от порядка включения факторов в модель, что не очень хорошо.
<ul>
<li>не используется</li>
</ul></li>
<li><strong>Второй (II)</strong> тип сумм квадратов проводит иерархические тесты, поэтому в этом случае результаты не зависят от порядка включения факторов в модель, однако величина эффекта все ещё зависит от объема выборки.
<ul>
<li>хорошо работает на сбалансированных данных</li>
</ul></li>
<li><strong>Третий (III) тип</strong> сумм квадратов проводит частные тесты. К данному подходу есть некоторые статистические вопросы, однако результаты в этом случае не зависят ни от порядка включения факторов в модель, ни от объёма выборки.
<ul>
<li>используют в случае несбалансированных данных, когда объемы групп по факторам различаются</li>
</ul></li>
</ul>
<p>Если у нас экспериментальный дизайн исследования, то мы, во-первых, на уровне планирования исследования делаем всё возможное, чтобы группы были уравнены, а также у нас, как правило, есть возможность добрать испытуемых, если в какой-то из групп из не хватает. Тогда мы по умолчанию используем II тип суммы квадратов.</p>
<p>Если же у нас, например, опросниковое исследование или такой дизайн, где респонденты разбиваются на группы post factum, мы не можем гарантировать, что эти группы окажутся равными по численности. В этом случае нам может помочь III типа суммы квадратов.</p>
</section>
</section>
<section id="контрасты" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="контрасты"><span class="header-section-number">9.6</span> Контрасты</h2>
<p>Иногда может случиться довольно экзотичная ситуация: даже при наличии нескольких групп наблюдений нас могут интересовать не все различия, а вполне определенные — то есть нам не нужно сравнивать все группы со всеми, а необходимо сравнить, скажем, одну группу со всеми остальными сразу. Например, у нас ситуация исследования в области образования. Мы хотим понять, как сказывается на качестве образования комбинация разных форматов обучения. Пусть целевой переменной будет итоговый балл студента по курсу. Есть три академические группы студентов: в одной освоение теоретической части курса происходит в формате лекций (<span class="math inline">\(\text{L}\)</span>), во второй — в формате групповой дискуссии (<span class="math inline">\(\text{G}\)</span>), в третьей реализован комбинированный формат (и лекции, и групповая дискуссия — <span class="math inline">\(\text{C}\)</span>). Сделать настоящую контрольную группу здесь не получается, поскольку нет какого-то нейтрального формата освоения теоретическая части, да и исключить полностью теоретическую часть из курса тоже как-то программа не очень позволяет.</p>
<p>При такой постановке задачи нас не интересуют различия между группами <span class="math inline">\(\text{L}\)</span> и <span class="math inline">\(\text{G}\)</span>. Наверное, они будут различаться, но нам эта разница совершенно не важна, так как для нас обе эти группы выступают как контрольные. Интересует же нас различие между группами <span class="math inline">\(\text{C}\)</span> и <span class="math inline">\(\text{L+G}\)</span>.</p>
<p>Мы можем, безусловно, подойти к решению этой задачи так, как предполагает дисперсионный анализ — изучить структуру изменчивости данных. Однако мы понимаем, что просто взять и соединить две группы <span class="math inline">\(\text{L}\)</span> и <span class="math inline">\(\text{G}\)</span> было бы не очень правомерно — все жё (1) могут различаться их средние, (2) хотелось бы учесть «истинную» (с учетом разделения на эти группы) случайную изменчивость. Для этого существуют <strong>контрасты</strong>.</p>
<p>Логика статистического теста остается похожей. У нас есть статистические гипотезы — в данном случае такие:</p>
<p><span class="math display">\[
\begin{split}
H_0 &amp;: \mu_{\text{C}} = \mu_{\text{L+G}} \\
H_0 &amp;: \mu_{\text{C}} \neq \mu_{\text{L+G}}
\end{split}
\]</span></p>
<p>Для тестирования гипотезы также используется F-статистика, которая считается аналогично:</p>
<p><span class="math display">\[
F = \frac{\text{MS}_\text{cont}}{\text{MS}_e},
\]</span></p>
<p>где <span class="math inline">\(\text{MS}_e\)</span> — это случайная изменчивость, а <span class="math inline">\(\text{MS}_\text{cont}\)</span> — «контрастная» изменчивость.</p>
<p>Случайная изменчивость вычисляется точно так же, как и раньше:</p>
<p><span class="math display">\[
\text{SS}_e = \displaystyle \sum_{j = \text{\{L,G,C\}}} \sum_{i=1}^{n_j} (\bar y_j - \bar y_{ji}),
\]</span></p>
<p>Осталось понять, как вычисляется <span class="math inline">\(\text{MS}_\text{cont}\)</span>. Общая формула должна сохраниться, поэтому можно записать, что</p>
<p><span class="math display">\[
\text{MS}_\text{cont} = \frac{\text{SS}_\text{cont}}{\text{df}_\text{cont}}
\]</span></p>
<p>Так как нам нужно сравнить две группы — <span class="math inline">\(\text{C}\)</span> и <span class="math inline">\(\text{L+G}\)</span> — то <span class="math inline">\(\text{df}_\text{cont} = 2-1 = 1\)</span>, а вот <span class="math inline">\(\text{SS}_\text{cont}\)</span> считается довольно хитро, хотя и всё ещё аналогично тому, что мы видели раньше:</p>
<p><span class="math display">\[
\begin{split}
\text{SS}_\text{cont} &amp; = \displaystyle \sum_{j=\{\text{C, L+G}\}} n_j \cdot (\bar y - \bar y_j)^2 = \\
&amp; = n_\text{C} \cdot (\bar y - \bar y_\text{C})^2 + n_\text{L+G} \cdot (\bar y - \bar y_\text{L+G})^2 = \\
&amp;= n_\text{C} \cdot (\bar y - \bar y_\text{C})^2 + (n_\text{L} + n_\text{G}) \cdot \left(\bar y - \frac{\bar y_\text{L} + \bar y_\text{G}}{2} \right)^2
\end{split}
\]</span></p>
<p>Получается, что мы по сути сравниваем, различается ли положение группы <span class="math inline">\(\text{C}\)</span> и <em>усредненное положение</em> групп <span class="math inline">\(\text{L}\)</span> и <span class="math inline">\(\text{G}\)</span> относительно общего среднего. При этом случайная изменчивость посчитана в заменателе F-статистики в сооветствии с тем, как распределены наблюдения по имеющимся в данных группам.</p>
<p>Аналогично можно сравнить и две группы в отдельности, например, <span class="math inline">\(\text{C}\)</span> и <span class="math inline">\(\text{G}\)</span> — будет отличаться только подсчет <span class="math inline">\(\text{SS}_\text{cont}\)</span>:</p>
<p><span class="math display">\[
\begin{split}
H_0 &amp;: \mu_{\text{C}} = \mu_{\text{G}} \\
H_0 &amp;: \mu_{\text{C}} \neq \mu_{\text{G}}
\end{split}
\]</span></p>
<p><span class="math display">\[
F = \frac{\text{MS}_\text{cont}}{\text{MS}_e},
\]</span></p>
<p><span class="math display">\[
\text{SS}_e = \displaystyle \sum_{j = \text{\{L,G,C\}}} \sum_{i=1}^{n_j} (\bar y_j - \bar y_{ji}),
\]</span></p>
<p><span class="math display">\[
\text{MS}_\text{cont} = \frac{\text{SS}_\text{cont}}{\text{df}_\text{cont}}
\]</span></p>
<p><span class="math display">\[
\begin{split}
\text{SS}_\text{cont} &amp; = \displaystyle \sum_{j=\{\text{C,G}\}} n_j \cdot (\bar y - \bar y_j)^2 = \\
&amp; = n_\text{C} \cdot (\bar y - \bar y_\text{C})^2 + n_\text{G} \cdot (\bar y - \bar y_\text{G})^2
\end{split}
\]</span></p>
<p>Поскольку в случае контрастов мы делаем конкретные сравнения каких-либо групп наблюдений, делать попарные сравнения нам не нужно — результаты контрастов уже показывают интересующие нас различия.</p>
</section>
<section id="ковариационный-анализ" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="ковариационный-анализ"><span class="header-section-number">9.7</span> Ковариационный анализ</h2>
<p>Когда мы обсуждали регрессионные модели с количественными и категориальными предикторами, мы говорили, что модель может включать взаимодействие количественного и категориального предиктора, а может не включать его. Если мы посмотрим на модель множественной линейной регрессии, в которой отсутствуют взаимодействия дискретных и непрерывных предикторов с точки зрения дисперсионного анализа, то получим <strong>модель ковариационного анализа (analysis of covariance, ANCOVA)</strong>. Мы можем подойти с другой стороны и сказать, что модель ковариационного анализа — это модель дисперсионного анализа, в которую включён (включены) один или несколько непрерывных предикторов. Непрерывный предиктор называется <strong>ковариатой</strong>. Ковариата — это переменная, которая [потенциально] связана с нашей целевой переменной, но её влияние не является целью нашего анализа.</p>
<p>Математическая модель будет абсолютно та же самая, что и раньше:</p>
<p><span class="math display">\[
\hat y_i = b_0 + b_1 I + b_2 x_2 = b_0 + b_1 x_1 + b_2 x_2
\]</span></p>
<p>Это самый простой вариант. Здесь <span class="math inline">\(x_1\)</span> — категориальный предиктор (принимает значения <span class="math inline">\(0\)</span> и <span class="math inline">\(1\)</span>), <span class="math inline">\(x_2\)</span> — ковариата, или непрерывный предиктор. Как можно заметить, взаимодействие в модель не включено.</p>
<p>Зачем вообще нам может понадобиться ковариата? На нашу целевую переменную могут влиять, помимо интересующих нас факторов, еще и разные другие. Вполне может случится такое, что различия, обнаруживаемые нами в ходе дисперсионного анализа, связаны не с влиянием фактора, а с действием каких-либо сторонних переменных. Введение ковариаты позволяет действие таких переменных учесть. Ковариата объяснит часть дисперсии данных, и вполне возможно, что значимость фактора пропадет. Пример такой ситуации мы рассмотрим на практике.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./l8.html" class="pagination-link" aria-label="L8 // Общие линейные модели. Простая и множественная линейная регрессия">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">L8 // Общие линейные модели. Простая и множественная линейная регрессия</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./l10.html" class="pagination-link" aria-label="L10 // Обобщенные линейные модели. Логистическая регрессия. Пуассоновская регрессия">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">L10 // Обобщенные линейные модели. Логистическая регрессия. Пуассоновская регрессия</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>